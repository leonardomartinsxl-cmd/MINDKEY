// ===============================
// MindKey ‚Äî QUIZ PREMIUM (FINAL)
// ===============================

document.addEventListener("DOMContentLoaded", () => {

  // üîπ BOT√ÉO
  const btn = document.getElementById("take-premium");
  if (!btn) return;

  btn.addEventListener("click", () => {

    // üîπ COLETA RESPOSTAS
    const answers = [];
    for (let i = 0; i < 30; i++) {
      const selected = document.querySelector(`.opt[data-q="p${i}"].selected`);
      if (!selected) {
        alert("Responda todas as 30 perguntas para gerar o relat√≥rio.");
        return;
      }
      answers.push(selected.dataset.val);
    }

    // üîπ SCORE
    const score = { A: 0, B: 0, C: 0, D: 0 };
    answers.forEach(a => score[a]++);

    const sorted = Object.keys(score).sort((a, b) => score[b] - score[a]);
    const primaryKey = sorted[0];
    const secondaryKey = sorted[1];

    const profiles = {
      A: {
        label: "Anal√≠tico",
        traits: [
          "L√≥gico e estrat√©gico",
          "Observador profundo",
          "Busca controle por conhecimento",
          "Age ap√≥s entender o cen√°rio"
        ],
        risks: [
          "Excesso de an√°lise",
          "Dificuldade em agir r√°pido",
          "Pode parecer frio"
        ]
      },
      B: {
        label: "Dominante",
        traits: [
          "Decisivo e direto",
          "Focado em resultados",
          "Alta energia de lideran√ßa",
          "Avesso √† lentid√£o"
        ],
        risks: [
          "Impaci√™ncia",
          "Conflitos diretos",
          "Dificuldade em ouvir"
        ]
      },
      C: {
        label: "Est√°vel",
        traits: [
          "Calmo e confi√°vel",
          "Busca harmonia",
          "Bom ouvinte",
          "Evita conflitos"
        ],
        risks: [
          "Dificuldade em se posicionar",
          "Resist√™ncia a mudan√ßas",
          "Autoanula√ß√£o"
        ]
      },
      D: {
        label: "Influente",
        traits: [
          "Comunicativo",
          "Inspirador",
          "Emocionalmente expressivo",
          "Cria conex√µes r√°pido"
        ],
        risks: [
          "Dispers√£o",
          "Busca excessiva por valida√ß√£o",
          "Falta de foco"
        ]
      }
    };

    const primary = profiles[primaryKey];
    const secondary = profiles[secondaryKey];

    // üîπ CONTAINER
    const container = document.getElementById("premium-report");
    if (!container) {
      alert("Erro: container do relat√≥rio n√£o encontrado.");
      return;
    }

    // üîπ RELAT√ìRIO HTML
    container.innerHTML = `
      <h2>üîç Relat√≥rio Premium MindKey</h2>

      <h3>Perfil Predominante</h3>
      <p><strong>${primary.label}</strong></p>
      <ul>
        ${primary.traits.map(t => `<li>${t}</li>`).join("")}
      </ul>

      <h3>Perfil Secund√°rio</h3>
      <p><strong>${secondary.label}</strong></p>
      <ul>
        ${secondary.traits.map(t => `<li>${t}</li>`).join("")}
      </ul>

      <h3>‚ö† Pontos de Aten√ß√£o</h3>
      <ul>
        ${primary.risks.map(r => `<li>${r}</li>`).join("")}
      </ul>

      <h3>üìä Distribui√ß√£o Comportamental</h3>
      <p>
        Anal√≠tico: ${score.A} ‚Ä¢ 
        Dominante: ${score.B} ‚Ä¢ 
        Est√°vel: ${score.C} ‚Ä¢ 
        Influente: ${score.D}
      </p>

      <h3>ü§ñ Prompt Personalizado para IA</h3>
      <pre>
You are an assistant helping a person with the following behavioral profile:

Primary profile: ${primary.label}
Secondary profile: ${secondary.label}

Key traits:
${primary.traits.join(", ")}

Communication rules:
- Seja direto
- Adapte o tom ao perfil
- Entregue a√ß√µes pr√°ticas
- Evite respostas gen√©ricas

Sempre responda considerando este perfil.
      </pre>

      <button id="copy-premium-prompt" class="btn">Copiar Prompt</button>
    `;

    // üîπ COPIAR PROMPT
    document.getElementById("copy-premium-prompt").addEventListener("click", () => {
      const text = container.querySelector("pre").innerText;
      navigator.clipboard.writeText(text);
      alert("Prompt copiado com sucesso!");
    });

    // üîπ SCROLL
    container.scrollIntoView({ behavior: "smooth" });

  });
});
