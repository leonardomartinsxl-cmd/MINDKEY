<script>
// ===============================
// MindKey — QUIZ GRATUITO (FINAL)
// ===============================

// ---------- PERGUNTAS ----------
const freeQuestions = [
  { text: "Quando algo te irrita, o que surge primeiro?", opts: ["A - Lógica", "B - Impulso", "C - Silêncio", "D - Emoção"] },
  { text: "No trabalho, você costuma:", opts: ["A - Analisar", "B - Liderar", "C - Apoiar", "D - Inspirar"] },
  { text: "Em conflitos, você tende a:", opts: ["A - Questionar", "B - Confrontar", "C - Evitar", "D - Conversar"] },
  { text: "Quando elogiado, você:", opts: ["A - Reflete", "B - Segue em frente", "C - Fica tímido", "D - Se conecta"] },
  { text: "Ao decidir algo importante:", opts: ["A - Analisa tudo", "B - Decide rápido", "C - Busca apoio", "D - Segue o sentimento"] },
  { text: "Em grupo, você é visto como:", opts: ["A - Estratégico", "B - Direto", "C - Confiável", "D - Carismático"] },
  { text: "Quando pressionado, você:", opts: ["A - Se fecha", "B - Acelera", "C - Procura equilíbrio", "D - Externaliza"] },
  { text: "Seu maior motivador é:", opts: ["A - Entendimento", "B - Resultado", "C - Harmonia", "D - Reconhecimento"] },
  { text: "Você prefere ambientes:", opts: ["A - Organizados", "B - Desafiadores", "C - Estáveis", "D - Criativos"] },
  { text: "Em decisões sociais, você:", opts: ["A - Observa", "B - Assume controle", "C - Apoia o grupo", "D - Conecta pessoas"] }
];

// ---------- HELPERS ----------
const el = id => document.getElementById(id);

// ---------- RENDER ----------
function renderFreeQuiz() {
  const container = el("quiz-questions");
  container.innerHTML = "";

  freeQuestions.forEach((q, i) => {
    const div = document.createElement("div");
    div.className = "q";

    div.innerHTML = `
      <p>${i + 1}. ${q.text}</p>
      <div class="opts">
        ${q.opts.map(opt => {
          const val = opt.charAt(0);
          return `
            <button class="opt"
              data-q="q${i}"
              data-val="${val}">
              ${opt}
            </button>
          `;
        }).join("")}
      </div>
    `;

    container.appendChild(div);
  });

  // seleção
  document.querySelectorAll(".opt").forEach(btn => {
    btn.addEventListener("click", () => {
      const q = btn.dataset.q;
      document
        .querySelectorAll(`.opt[data-q="${q}"]`)
        .forEach(b => b.classList.remove("selected"));
      btn.classList.add("selected");
    });
  });
}

// ---------- COLETA ----------
function collectAnswers() {
  const answers = [];
  for (let i = 0; i < freeQuestions.length; i++) {
    const sel = document.querySelector(`.opt[data-q="q${i}"].selected`);
    if (!sel) return null;
    answers.push(sel.dataset.val);
  }
  return answers;
}

// ---------- SCORE ----------
function scoreAnswers(answers) {
  const score = { A: 0, B: 0, C: 0, D: 0 };
  answers.forEach(a => score[a]++);
  const sorted = Object.keys(score).sort((a, b) => score[b] - score[a]);
  return { score, primary: sorted[0], secondary: sorted[1] };
}

// ---------- PERFIS ----------
const profiles = {
  A: { label: "Analítico", explain: "Você pensa antes de agir, observa padrões e busca clareza antes de se posicionar." },
  B: { label: "Executor", explain: "Você age com velocidade, foco em resultado e não tolera desperdício de tempo." },
  C: { label: "Estável", explain: "Você valoriza harmonia, previsibilidade e relações confiáveis." },
  D: { label: "Influente", explain: "Você conecta pessoas, transmite energia e influencia ambientes." }
};

// ---------- PROMPT ----------
function buildPrompt(profile, score) {
  return `
Sou uma pessoa com perfil predominante ${profile.label}.

Resumo comportamental:
${profile.explain}

Distribuição:
Analítico: ${score.A}
Executor: ${score.B}
Estável: ${score.C}
Influente: ${score.D}

Ao me ajudar:
- Seja direto
- Adapte sua comunicação ao meu perfil
- Traga frases prontas para situações reais

Situação:
[descreva aqui]
`.trim();
}

// ---------- RESULTADO ----------
function showResult(scored) {
  const primary = profiles[scored.primary];
  el("result-primary").textContent = primary.label;
  el("result-explain").textContent = primary.explain;
  el("result-detail").textContent =
    `A:${scored.score.A} • B:${scored.score.B} • C:${scored.score.C} • D:${scored.score.D}`;

  el("prompt-area").textContent = buildPrompt(primary, scored.score);
  el("result-box").style.display = "block";
  el("result-box").scrollIntoView({ behavior: "smooth" });
}

// ---------- INIT ----------
document.addEventListener("DOMContentLoaded", () => {
  renderFreeQuiz();

  el("take-quiz").addEventListener("click", () => {
    const answers = collectAnswers();
    if (!answers) {
      alert("Responda todas as 10 perguntas para continuar.");
      return;
    }
    const scored = scoreAnswers(answers);
    showResult(scored);
  });

  el("copy-prompt").addEventListener("click", () => {
    navigator.clipboard.writeText(el("prompt-area").textContent);
    alert("Prompt copiado!");
  });
});
</script>
